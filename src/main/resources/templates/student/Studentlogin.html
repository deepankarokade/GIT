<!DOCTYPE html>
<html class="light" lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Login - ExamPortal</title>
  <meta name="description" content="Login to the Portal to manage exams, students, and results." />
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
    rel="stylesheet" />
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#135bec",
            "background-light": "#f6f6f8",
            "background-dark": "#101622",
          },
          fontFamily: {
            "display": ["Lexend", "sans-serif"]
          },
        },
      },
    }
  </script>
  <style>
    body {
      font-family: 'Lexend', sans-serif;
    }

    .geometric-bg {
      background-image:
        radial-gradient(rgba(0, 150, 136, 0.25) 1px, transparent 1px),
        linear-gradient(135deg, #5ee7df 0%, #b490ca 50%, #5ee7df 100%);
      background-size: 24px 24px, 100% 100%;
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-10px);
      }
    }

    .float-animation {
      animation: float 6s ease-in-out infinite;
    }

    .glow-effect {
      box-shadow: 0 0 60px rgba(19, 91, 236, 0.3);
    }

    .input-animated:focus {
      transform: translateY(-2px);
    }

    .gradient-text {
      background: linear-gradient(135deg, #135bec 0%, #8b5cf6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }



    /* --- New ExamBot Styles --- */
    .chatbot-container {
      width: 320px;
      background: #fff;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }

    .dark .chatbot-container {
      background: #1e293b;
      border: 1px solid #334155;
    }

    .chat-header {
      padding: 12px 15px;
      background: linear-gradient(135deg, #6a5cff, #ff5fa2);
      color: #fff;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .bot-icon {
      width: 36px;
      height: 36px;
      background: #fff;
      color: #6a5cff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 18px;
    }

    .header-title {
      font-size: 16px;
      font-weight: 600;
    }

    .status-dot {
      font-size: 11px;
      color: #dfffe2;
    }

    .chat-body {
      padding: 12px;
      background: #f8f9fd;
      height: 320px;
      overflow-y: auto;
    }

    .dark .chat-body {
      background: #0f172a;
    }

    .bot-msg-bubble {
      background: #fff;
      padding: 10px 12px;
      border-radius: 12px;
      margin-bottom: 12px;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      color: #334155;
      line-height: 1.5;
    }

    .dark .bot-msg-bubble {
      background: #1e293b;
      color: #f1f5f9;
      box-shadow: none;
    }

    .chat-option {
      background: #fff;
      padding: 10px 12px;
      border-radius: 10px;
      margin-bottom: 8px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid #eee;
      font-size: 14px;
      transition: .2s;
      color: #334155;
    }

    .dark .chat-option {
      background: #1e293b;
      border-color: #334155;
      color: #f1f5f9;
    }

    .chat-option:hover {
      background: #f0f3ff;
      border-color: #6a5cff;
    }

    .dark .chat-option:hover {
      background: #334155;
    }

    .chat-option.active {
      background: #6a5cff;
      color: #fff;
      border-color: #6a5cff;
    }

    .chat-arrow {
      color: #aaa;
    }

    .chat-answer {
      background: #eaeaff;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 12px;
      font-size: 13px;
      color: #475569;
      border-left: 4px solid #6a5cff;
    }

    .dark .chat-answer {
      background: #1e293b;
      color: #cbd5e1;
      border-left-color: #6a5cff;
    }

    .user-msg-row {
      text-align: right;
      margin-bottom: 10px;
    }

    .user-msg-bubble {
      background: #6a5cff;
      color: #fff;
      padding: 8px 12px;
      border-radius: 12px 12px 0 12px;
      display: inline-block;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(106, 92, 255, 0.2);
    }

    .bot-reply-bubble {
      background: #eaeaff;
      color: #475569;
      padding: 8px 12px;
      border-radius: 12px 12px 12px 0;
      display: inline-block;
      font-size: 14px;
      margin-bottom: 10px;
    }

    .dark .bot-reply-bubble {
      background: #334155;
      color: #f1f5f9;
    }

    .chat-footer {
      display: flex;
      padding: 10px;
      border-top: 1px solid #eee;
      background: #fff;
    }

    .dark .chat-footer {
      background: #1e293b;
      border-top-color: #334155;
    }

    .chat-input {
      flex: 1;
      height: 40px;
      /* üî¥ height compulsory */
      padding: 0 18px;
      border-radius: 9999px !important;
      /* üî¥ force round */
      border: 1px solid #ddd;
      outline: none;
      font-size: 14px;
      line-height: 40px;
      /* üî¥ vertical center */
      appearance: none;
      /* üî¥ Tailwind override */
      -webkit-appearance: none;
    }

    .dark .chat-input {
      background: #0f172a;
      border-color: #334155;
      color: #fff;
      border-radius: 9999px !important;
    }


    .chat-input:focus {
      border-color: #6a5cff;
      box-shadow: 0 0 0 2px rgba(106, 92, 255, 0.2);
    }

    .chat-send-btn {
      margin-left: 8px;
      background: #6a5cff;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
    }

    .chat-send-btn:hover {
      transform: scale(1.1);
      background: #5a4ee0;
    }

    .chat-back-btn {
      margin-bottom: 10px;
      background: #6a5cff;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 6px 12px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .chat-back-btn:hover {
      background: #5a4ee0;
    }
  </style>
</head>

<body class="geometric-bg min-h-screen flex items-center justify-center p-4">

  <!-- Decorative Floating Shapes -->
  <div class="fixed inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-20 left-10 w-72 h-72 bg-primary/10 rounded-full blur-3xl float-animation"></div>
    <div class="absolute bottom-20 right-10 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl float-animation"
      style="animation-delay: -2s;"></div>
    <div class="absolute top-1/2 left-1/4 w-48 h-48 bg-cyan-500/10 rounded-full blur-3xl float-animation"
      style="animation-delay: -4s;"></div>
  </div>

  <!-- Login Container -->
  <div class="relative z-10 w-full max-w-md">

    <!-- Logo & Header -->
    <div class="text-center mb-8">
      <div class="inline-flex items-center justify-center w-16 h-16 bg-primary/20 rounded-2xl mb-4 glow-effect">
        <svg class="w-8 h-8 text-primary" fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
          <path d="M44 4H30.6666V17.3334H17.3334V30.6666H4V44H44V4Z" fill="currentColor"></path>
        </svg>
      </div>
      <h1 class="text-3xl font-bold text-black mb-2">ExamPortal</h1>
      <h5 class="font-bold text-black mb-2">Sign in to your Portal</h5>
    </div>

    <!-- Login Card -->
    <div class="bg-slate-900/80 backdrop-blur-xl rounded-3xl p-8 border border-slate-800 shadow-2xl glow-effect">

      <!-- Tabs: Student | Professor -->
      <div class="flex items-center justify-center gap-2 mb-8 border-b border-slate-700">
        <button id="studentTab"
          th:class="${activeTab != 'professor' ? 'px-6 py-2 text-white font-semibold border-b-2 border-primary' : 'px-6 py-2 text-slate-400 font-semibold border-b-2 border-transparent hover:text-white transition-colors'}">Student</button>
        <button id="professorTab"
          th:class="${activeTab == 'professor' ? 'px-6 py-2 text-white font-semibold border-b-2 border-primary' : 'px-6 py-2 text-slate-400 font-semibold border-b-2 border-transparent hover:text-white transition-colors'}">Professor</button>
      </div>

      <!-- Forms -->
      <!-- Student Form -->
      <form id="studentForm" th:class="${activeTab != 'professor' ? 'space-y-6' : 'hidden space-y-6'}"
        th:action="@{/student/login}" method="post">
        <!-- Error Message for Student -->
        <div th:if="${error != null and activeTab != 'professor'}"
          class="flex items-center gap-3 p-4 rounded-xl bg-red-500/10 border border-red-500/30 mb-4">
          <span class="material-symbols-outlined text-red-500">error</span>
          <p class="text-red-400 text-sm font-medium" th:text="${error}">Invalid credentials</p>
        </div>

        <!-- Success Message for Student -->
        <div th:if="${info != null and activeTab != 'professor'}"
          class="flex items-center gap-3 p-4 rounded-xl bg-green-500/10 border border-green-500/30 mb-4">
          <span class="material-symbols-outlined text-green-500">check</span>
          <p class="text-green-400 text-sm font-medium" th:text="${info}"></p>
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-300 flex items-center gap-2">
            <span class="material-symbols-outlined text-lg text-primary">person</span>
            Student UID
          </label>
          <input type="text" name="uid" placeholder="Enter your Student UID"
            class="input-animated w-full px-4 py-4 rounded-xl border border-slate-700 bg-slate-800/50 text-white placeholder-slate-500 focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
            required>
        </div>

        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-300 flex items-center gap-2">
            <span class="material-symbols-outlined text-lg text-purple-400">lock</span>
            Password
          </label>
          <input type="password" name="password" placeholder="Enter your password"
            class="input-animated w-full px-4 py-4 rounded-xl border border-slate-700 bg-slate-800/50 text-white placeholder-slate-500 focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200"
            required>
        </div>

        <!-- Links for student -->
        <div class="flex justify-between text-sm">
          <a href="/student/forgot-password" class="text-primary hover:underline">Forgot Password?</a>
          <a href="/student/registration" class="text-primary hover:underline">Sign Up</a>
        </div>

        <button type="submit"
          class="w-full flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-primary to-blue-600 hover:from-blue-600 hover:to-primary text-white rounded-xl font-bold text-lg transition-all duration-300 shadow-lg shadow-primary/30 hover:shadow-xl hover:shadow-primary/40 hover:-translate-y-0.5">
          <span class="material-symbols-outlined">login</span>
          Sign In
        </button>
      </form>

      <!-- Professor Form -->
      <form id="professorForm" th:class="${activeTab == 'professor' ? 'space-y-6' : 'hidden space-y-6'}"
        th:action="@{/professor/login}" method="post">
        <!-- Username -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-300 flex items-center gap-2">
            <span class="material-symbols-outlined text-lg text-primary">person</span>
            Username
          </label>
          <input type="text" name="username" required placeholder="Enter your username" autofocus
            class="input-animated w-full px-4 py-4 rounded-xl border border-slate-700 bg-slate-800/50 text-white placeholder-slate-500 focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200">
        </div>

        <!-- Password -->
        <div class="space-y-2">
          <label class="block text-sm font-medium text-slate-300 flex items-center gap-2">
            <span class="material-symbols-outlined text-lg text-purple-400">lock</span>
            Password
          </label>
          <div class="relative">
            <input type="password" name="password" id="password" required placeholder="Enter your password"
              class="input-animated w-full px-4 py-4 rounded-xl border border-slate-700 bg-slate-800/50 text-white placeholder-slate-500 focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-200 pr-12">
            <button type="button" onclick="togglePassword()"
              class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 hover:text-primary transition-colors">
              <span class="material-symbols-outlined" id="toggleIcon">visibility</span>
            </button>
          </div>
        </div>

        <!-- Remember & Forgot -->
        <div class="flex items-center justify-between">
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox"
              class="w-4 h-4 rounded border-slate-700 bg-slate-800 text-primary focus:ring-primary focus:ring-offset-0 cursor-pointer">
            <span class="text-sm text-slate-400">Remember me</span>
          </label>
          <a href="/faculty/viewforget" class="text-sm text-primary hover:text-blue-400 transition-colors">Forgot
            password?</a>
        </div>

        <!-- Error Message -->
        <div th:if="${error != null and activeTab == 'professor'}"
          class="flex items-center gap-3 p-4 rounded-xl bg-red-500/10 border border-red-500/30">
          <span class="material-symbols-outlined text-red-500">error</span>
          <p class="text-red-400 text-sm font-medium" th:text="${error}">Invalid credentials</p>
        </div>


        <div th:if="${info != null and activeTab == 'professor'}"
          class="flex items-center gap-3 p-4 rounded-xl bg-green-500/10 border border-green-500/30 mb-4">
          <span class="material-symbols-outlined text-green-500">check</span>
          <p class="text-green-400 text-sm font-medium" th:text="${info}"></p>
        </div>

        <!-- Login Button -->
        <button type="submit"
          class="w-full flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-primary to-blue-600 hover:from-blue-600 hover:to-primary text-white rounded-xl font-bold text-lg transition-all duration-300 shadow-lg shadow-primary/30 hover:shadow-xl hover:shadow-primary/40 hover:-translate-y-0.5">
          <span class="material-symbols-outlined">login</span>
          Sign In
        </button>
      </form>

    </div>


    <div th:if="${loginSuccess}"
      class="flex items-center gap-3 p-4 rounded-xl bg-green-500/10 border border-green-500/30 mb-4">
      <span class="material-symbols-outlined text-green-500">check</span>
      <p class="text-green-400 text-sm font-medium" th:text="${loginSuccess}">
      </p>
    </div>

    <!-- Reset Password Popup -->
    <div id="resetPopup" th:if="${showResetPopup}"
      class="fixed inset-0 bg-black/60 flex items-center justify-center z-50">

      <div class="bg-white dark:bg-slate-900 rounded-2xl p-6 w-[90%] max-w-md shadow-xl">
        <h2 class="text-xl font-bold text-slate-900 dark:text-white mb-3">
          Reset Password?
        </h2>

        <p class="text-slate-600 dark:text-slate-400 mb-6">
          Do you want to reset your password now?
        </p>

        <div class="flex justify-end gap-4">
          <!-- Skip -->
          <a th:href="${activeTab == 'professor' ? '/professor/dashboard' : '/student/dashboard'}"
            class="px-5 py-2 rounded-xl text-slate-400 font-semibold hover:text-slate-200 transition-colors">Skip</a>


          <!-- Continue -->
          <a th:href="${activeTab == 'professor' ? '/professor/change-password' : '/student/change-password-page'}"
            class="px-5 py-2 rounded-xl bg-primary text-white font-semibold shadow-lg shadow-primary/30 hover:shadow-primary/50 transition-all">
            Continue
          </a>

        </div>
      </div>
    </div>

  </div>
  <!-- Chatbot Button -->
  <div onclick="toggleChat()" class="fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-br from-secondary to-cyan-400
              text-white rounded-full flex items-center justify-center shadow-lg
              cursor-pointer hover:scale-110 transition-transform z-50">
    ü§ñ
  </div>

  <!-- Chatbot Modal -->
  <div id="chatbot" class="fixed bottom-24 right-6 z-50 hidden">
    <div class="chatbot-container">
      <!-- HEADER -->
      <div class="chat-header">
        <div class="bot-icon">ü§ñ</div>
        <div class="flex-1">
          <div class="header-title">ExamBot</div>
          <div class="status-dot">‚óè Online</div>
        </div>
        <button onclick="toggleChat()" class="text-white/80 hover:text-white transition-colors">
          <span class="material-symbols-outlined text-xl">close</span>
        </button>
      </div>

      <!-- BODY -->
      <div class="chat-body" id="chatBody">
        <!-- Content injected via JS -->
      </div>

      <!-- FOOTER -->
      <div class="chat-footer">
        <input type="text" id="msg" placeholder="Type a message..." maxlength="100" onkeydown="handleEnter(event)"
          class="chat-input">
        <button onclick="send()" class="chat-send-btn">
          <span class="material-symbols-outlined text-lg">send</span>
        </button>
      </div>
    </div>
  </div>




  <script>
    // Tab Switching
    const studentTab = document.getElementById('studentTab');
    const professorTab = document.getElementById('professorTab');
    const studentForm = document.getElementById('studentForm');
    const professorForm = document.getElementById('professorForm');

    studentTab.addEventListener('click', () => {
      studentTab.classList.add('text-white', 'border-primary');
      studentTab.classList.remove('text-slate-400', 'border-transparent');
      professorTab.classList.add('text-slate-400', 'border-transparent');
      professorTab.classList.remove('text-white', 'border-primary');
      studentForm.classList.remove('hidden');
      professorForm.classList.add('hidden');
    });

    professorTab.addEventListener('click', () => {
      professorTab.classList.add('text-white', 'border-primary');
      professorTab.classList.remove('text-slate-400', 'border-transparent');
      studentTab.classList.add('text-slate-400', 'border-transparent');
      studentTab.classList.remove('text-white', 'border-primary');
      professorForm.classList.remove('hidden');
      studentForm.classList.add('hidden');
    });

    // Password toggle
    function togglePassword() {
      const passwordInput = document.getElementById('password');
      const toggleIcon = document.getElementById('toggleIcon');
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleIcon.textContent = 'visibility_off';
      } else {
        passwordInput.type = 'password';
        toggleIcon.textContent = 'visibility';
      }
    }

    // Subtle input focus animation
    document.querySelectorAll('input').forEach(input => {
      input.addEventListener('focus', function () {
        this.parentElement.classList.add('scale-[1.02]');
      });
      input.addEventListener('blur', function () {
        this.parentElement.classList.remove('scale-[1.02]');
      });
    });

  </script>
  <script>
    const chat = document.getElementById("chatBody");

    /* ---------------- TOGGLE ---------------- */
    function toggleChat() {
      document.getElementById("chatbot").classList.toggle("hidden");
    }

    function handleEnter(event) {
      if (event.key === 'Enter') send();
    }

    /* ---------------- DASHBOARD ---------------- */
    function showDashboard() {
      chat.innerHTML = `
                 <div class="bot-msg-bubble">
                     Hi üëã I‚Äôm here to help with your exams and results.  
                     What would you like to know?
                 </div>

                 <div class="chat-option" onclick="loadFaqs()">
                     <span>üìå FAQs</span>
                     <span class="chat-arrow">‚Ä∫</span>
                 </div>
             `;
    }

    /* ---------------- BACK BUTTON ---------------- */
    function addBackButton() {
      if (document.querySelector(".chat-back-btn")) return;

      const backBtn = document.createElement("button");
      backBtn.className = "chat-back-btn";
      backBtn.innerHTML = `<span class="material-symbols-outlined text-sm">arrow_back</span> Back to Dashboard`;
      backBtn.onclick = showDashboard;
      chat.prepend(backBtn);
    }

    /* ---------------- LOAD FAQ ---------------- */
    function loadFaqs() {
      chat.innerHTML = "";
      addBackButton();

      fetch("/chatbot/questions")
        .then(res => res.json())
        .then(faqs => {
          if (faqs.length === 0) {
            chat.innerHTML += `<div class="bot-reply-bubble"><span>No FAQs found!</span></div>`;
            return;
          }

          faqs.forEach(q => {
            const d = document.createElement("div");
            d.className = "chat-option";
            d.innerHTML = `${q}<span class="chat-arrow">‚Ä∫</span>`;
            d.onclick = () => showAnswer(q, d);
            chat.appendChild(d);
          });
        });
    }

    /* ---------------- SHOW ANSWER ---------------- */
    function showAnswer(question, optionDiv) {
      // remove previous answers
      document.querySelectorAll(".chat-answer").forEach(a => a.remove());

      // remove highlight from all questions
      document.querySelectorAll(".chat-option").forEach(o => o.classList.remove("active"));

      // highlight clicked question
      optionDiv.classList.add("active");

      fetch(`/chatbot/ask?message=${encodeURIComponent(question)}`, {
        method: "POST"
      })
        .then(res => res.text())
        .then(answer => {
          const ans = document.createElement("div");
          ans.className = "chat-answer";
          ans.innerText = answer;

          // show answer just below the same question
          optionDiv.after(ans);
          chat.scrollTop = optionDiv.offsetTop - 50;
        });
    }

    /* ---------------- USER MESSAGE ---------------- */
    function showUser(msg) {
      addBackButton();

      const userDiv = document.createElement("div");
      userDiv.className = "user-msg-row";
      userDiv.innerHTML = `<span class="user-msg-bubble">${msg}</span>`;

      chat.appendChild(userDiv);
      chat.scrollTop = chat.scrollHeight;
    }

    /* ---------------- SEND MESSAGE ---------------- */
    function send() {
      const i = document.getElementById("msg");
      const text = i.value.trim();

      if (!text) {
        alert("‚ùå Please enter a question");
        return;
      }

      fetch(`/chatbot/validate?message=${encodeURIComponent(text)}`, {
        method: "POST"
      })
        .then(res => res.json())
        .then(isValid => {
          if (!isValid) {
            alert("‚ùå Invalid question! Please type a proper question (e.g., 'Exam Result').");
            return;
          }

          showUser(text);

          fetch(`/chatbot/ask?message=${encodeURIComponent(text)}`, {
            method: "POST"
          })
            .then(res => res.text())
            .then(reply => {
              const botDiv = document.createElement("div");
              botDiv.className = "bot-reply-bubble";
              botDiv.innerHTML = `<span>${reply}</span>`;
              chat.appendChild(botDiv);
              chat.scrollTop = chat.scrollHeight;
            });

          i.value = "";
        });
    }

    /* ---------------- INIT ---------------- */
    showDashboard();


    // Submenu toggle function
    function toggleSubmenu(submenuId) {
      const submenu = document.getElementById(submenuId);
      const icon = document.getElementById(submenuId + 'Icon');

      if (submenu.classList.contains('hidden')) {
        submenu.classList.remove('hidden');
        submenu.classList.add('flex');
        if (icon) icon.style.transform = 'rotate(180deg)';
      } else {
        submenu.classList.add('hidden');
        submenu.classList.remove('flex');
        if (icon) icon.style.transform = 'rotate(0deg)';
      }
    }

    // Chatbot toggle function
    function toggleChat() {
      const chat = document.getElementById("chatbot");
      chat.classList.toggle("hidden");
    }

    function toggleProfileMenu() {
      document.getElementById("profileMenu").classList.toggle("hidden");
    }

    /* Close when clicking outside */
    document.addEventListener("click", function (e) {
      const menu = document.getElementById("profileMenu");
      const avatar = e.target.closest(".rounded-full");

      if (!menu.contains(e.target) && !avatar) {
        menu.classList.add("hidden");
      }
    });
  </script>
</body>

</html>