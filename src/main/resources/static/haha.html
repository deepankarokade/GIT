<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Exam - Tailwind Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        .custom-scrollbar:hover::-webkit-scrollbar-thumb {
            background: #94a3b8;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900 min-h-screen">

    <div class="max-w-screen-2xl mx-auto px-4 py-4">

        <!-- HEADER (Sticky) -->
        <header
            class="sticky top-4 z-50 bg-white/80 backdrop-blur-md border border-slate-200 rounded-2xl shadow-sm mb-6">
            <div class="px-6 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="space-y-1 text-center md:text-left">
                    <h1
                        class="text-xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
                        Subject: <span th:text="${paper.subject}">Mathematics</span> - Set <span
                            th:text="${paper.selectset}">A</span>
                    </h1>
                    <div
                        class="flex flex-wrap justify-center md:justify-start gap-4 text-xs font-medium text-slate-500 uppercase tracking-wider">
                        <span class="flex items-center gap-1.5"><strong class="text-slate-700">Chapter:</strong> <span
                                th:text="${paper.chapter}">Algebra</span></span>
                        <span class="flex items-center gap-1.5"><strong class="text-slate-700">Duration:</strong> <span
                                th:text="${paper.duration}">40</span> min</span>
                        <span class="flex items-center gap-1.5"><strong class="text-slate-700">Level:</strong> <span
                                th:text="${paper.difficulty}">Medium</span></span>
                    </div>
                </div>
                <button onclick="submitExam()"
                    class="px-8 py-2.5 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-xl shadow-lg shadow-emerald-200 transition-all active:scale-95">
                    Submit Exam
                </button>
            </div>
        </header>

        <div class="grid grid-cols-12 gap-6 relative">

            <!-- LEFT: SECTIONS -->
            <aside class="col-span-12 lg:col-span-2 space-y-2">
                <div class="bg-white border border-slate-200 rounded-2xl p-4 shadow-sm sticky top-28">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 px-2">Sections</h3>
                    <nav class="space-y-1">
                        <button onclick="jumpSection('mcq')"
                            class="w-full text-left px-4 py-2.5 rounded-xl hover:bg-blue-50 hover:text-blue-600 text-slate-600 transition-colors font-medium">MCQ</button>
                        <button onclick="jumpSection('fill')"
                            class="w-full text-left px-4 py-2.5 rounded-xl hover:bg-blue-50 hover:text-blue-600 text-slate-600 transition-colors font-medium">Fill
                            Blocks</button>
                        <button onclick="jumpSection('match')"
                            class="w-full text-left px-4 py-2.5 rounded-xl hover:bg-blue-50 hover:text-blue-600 text-slate-600 transition-colors font-medium">Matching</button>
                        <button onclick="jumpSection('tf')"
                            class="w-full text-left px-4 py-2.5 rounded-xl hover:bg-blue-50 hover:text-blue-600 text-slate-600 transition-colors font-medium">True/False</button>
                        <button onclick="jumpSection('short')"
                            class="w-full text-left px-4 py-2.5 rounded-xl hover:bg-blue-50 hover:text-blue-600 text-slate-600 transition-colors font-medium">Short
                            Ans</button>
                        <button onclick="jumpSection('long')"
                            class="w-full text-left px-4 py-2.5 rounded-xl hover:bg-blue-50 hover:text-blue-600 text-slate-600 transition-colors font-medium">Long
                            Ans</button>
                        <button onclick="jumpSection('essay')"
                            class="w-full text-left px-4 py-2.5 rounded-xl hover:bg-blue-50 hover:text-blue-600 text-slate-600 transition-colors font-medium">Essay</button>
                    </nav>
                </div>
            </aside>

            <!-- CENTER: QUESTION CONTENT -->
            <main class="col-span-12 lg:col-span-8">
                <div
                    class="bg-white border border-slate-200 rounded-2xl shadow-sm min-h-[450px] p-8 relative flex flex-col">

                    <div id="questionContainer" class="flex-1">
                        <!-- MOCK QUESTIONS FOR STATIC TESTING -->
                        <div class="question-slide" data-index="0" data-type="mcq" style="display:block">
                            <h2 class="text-xl font-bold text-slate-800 mb-6">Q1. What is the capital of France?</h2>
                            <div class="space-y-3">
                                <label
                                    class="flex items-center p-4 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-all group">
                                    <input type="radio" name="mock_1" onchange="markAnswered()"
                                        class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-slate-300">
                                    <span class="ml-4 font-medium text-slate-700 group-hover:text-slate-900">A.
                                        Paris</span>
                                </label>
                                <label
                                    class="flex items-center p-4 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-all group">
                                    <input type="radio" name="mock_1" onchange="markAnswered()"
                                        class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-slate-300">
                                    <span class="ml-4 font-medium text-slate-700 group-hover:text-slate-900">B.
                                        London</span>
                                </label>
                                <label
                                    class="flex items-center p-4 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-all group">
                                    <input type="radio" name="mock_1" onchange="markAnswered()"
                                        class="w-4 h-4 text-blue-600 focus:ring-blue-500 border-slate-300">
                                    <span class="ml-4 font-medium text-slate-700 group-hover:text-slate-900">C.
                                        Berlin</span>
                                </label>
                            </div>
                        </div>

                        <div class="question-slide" data-index="1" data-type="tf" style="display:none">
                            <h2 class="text-xl font-bold text-slate-800 mb-6">Q2. The Earth is flat.</h2>
                            <div class="flex gap-4">
                                <label
                                    class="flex-1 text-center py-4 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-all">
                                    <input type="radio" name="mock_2" onchange="markAnswered()" class="hidden peer">
                                    <span
                                        class="font-bold text-slate-600 peer-checked:text-blue-600 peer-checked:border-blue-600">TRUE</span>
                                </label>
                                <label
                                    class="flex-1 text-center py-4 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-all">
                                    <input type="radio" name="mock_2" onchange="markAnswered()" class="hidden peer">
                                    <span
                                        class="font-bold text-slate-600 peer-checked:text-blue-600 peer-checked:border-blue-600">FALSE</span>
                                </label>
                            </div>
                        </div>

                        <div class="question-slide" data-index="2" data-type="short" style="display:none">
                            <h2 class="text-xl font-bold text-slate-800 mb-6">Q3. Explain photosynthesis in short.</h2>
                            <textarea oninput="markAnswered()"
                                class="w-full border border-slate-200 rounded-xl p-4 min-h-[150px] focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all outline-none text-slate-700"
                                placeholder="Type your answer here..."></textarea>
                        </div>

                        <!-- THYMELEAF DYNAMIC QUESTIONS -->
                        <div th:each="question,stat : ${questions}" class="question-slide"
                            th:attr="data-index=${stat.index + 3},data-type=${question.questionType}"
                            style="display:none">

                            <h2 class="text-xl font-bold text-slate-800 mb-6">
                                Q<span th:text="${stat.count + 3}">1</span>.
                                <span th:text="${question.questionText}">Question Text</span>
                            </h2>

                            <!-- MCQ -->
                            <div th:if="${question.questionType=='mcq'}" class="space-y-3">
                                <label th:each="opt,optStat : ${#strings.arraySplit(question.options,'|')}"
                                    class="flex items-center p-4 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50 transition-all group">
                                    <input type="radio" th:name="'q_'+${question.id}" onchange="markAnswered()"
                                        class="w-4 h-4 text-blue-600 border-slate-300">
                                    <span class="ml-4 font-medium text-slate-700 group-hover:text-slate-900">
                                        <b th:text="${T(java.lang.Character).toString(65 + optStat.index)} + '.'"></b>
                                        <span th:text="${opt}"></span>
                                    </span>
                                </label>
                            </div>

                            <!-- TRUE/FALSE -->
                            <div th:if="${question.questionType=='tf'}" class="flex gap-4">
                                <label
                                    class="flex-1 text-center py-4 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50">
                                    <input type="radio" th:name="'q_'+${question.id}" onchange="markAnswered()"
                                        class="w-4 h-4 text-blue-600">
                                    <span class="ml-2 font-bold text-slate-700">TRUE</span>
                                </label>
                                <label
                                    class="flex-1 text-center py-4 border border-slate-200 rounded-xl cursor-pointer hover:bg-slate-50">
                                    <input type="radio" th:name="'q_'+${question.id}" onchange="markAnswered()"
                                        class="w-4 h-4 text-blue-600">
                                    <span class="ml-2 font-bold text-slate-700">FALSE</span>
                                </label>
                            </div>

                            <!-- FILL -->
                            <div th:if="${question.questionType=='fill'}" class="flex flex-wrap gap-2">
                                <button th:each="opt : ${#strings.arraySplit(question.fillintheblanks,'|')}"
                                    class="px-5 py-2 border-2 border-slate-200 rounded-xl font-bold text-slate-600 hover:border-blue-500 hover:text-blue-500 transition-all fill-btn"
                                    onclick="fillSelect(this)">
                                    <span th:text="${opt}"></span>
                                </button>
                            </div>

                            <!-- SHORT / LONG / ESSAY -->
                            <div th:if="${question.questionType=='short' or question.questionType=='long' or question.questionType=='essay'}"
                                class="mt-4">
                                <textarea oninput="markAnswered()"
                                    class="w-full border border-slate-200 rounded-xl p-4 min-h-[200px] outline-none focus:ring-2 focus:ring-blue-500"
                                    placeholder="Write your detailed answer here..."></textarea>
                            </div>

                            <!-- MATCH -->
                            <div th:if="${question.questionType=='match'}" class="space-y-4">
                                <div th:each="pair,st : ${question.parsedMatchPairs}"
                                    class="grid grid-cols-11 items-center gap-2">
                                    <div class="col-span-5 p-3 bg-slate-50 border border-slate-200 rounded-xl text-center font-medium shadow-sm"
                                        th:text="${pair[0]}"></div>
                                    <div class="col-span-1 text-center text-slate-400 text-xl font-bold">â‡’</div>
                                    <div class="col-span-5 p-3 bg-slate-50 border border-slate-200 rounded-xl text-center font-medium shadow-sm"
                                        th:text="${pair[1]}"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- FOOTER NAVIGATION -->
                    <div class="mt-8 pt-6 border-t border-slate-100 flex justify-between items-center">
                        <button id="prevBtn" onclick="prevQ()"
                            class="flex items-center gap-2 px-6 py-2.5 bg-slate-100 disabled:opacity-30 disabled:cursor-not-allowed hover:bg-slate-200 text-slate-700 font-bold rounded-xl transition-all active:scale-95">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 19l-7-7 7-7" />
                            </svg>
                            <span>Previous</span>
                        </button>
                        <button id="nextBtn" onclick="nextQ()"
                            class="flex items-center gap-2 px-6 py-2.5 bg-blue-600 disabled:bg-slate-200 disabled:text-slate-400 disabled:cursor-not-allowed hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg shadow-blue-100 transition-all active:scale-95">
                            <span>Next Question</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 5l7 7-7 7" />
                            </svg>
                        </button>
                    </div>
                </div>
            </main>

            <!-- RIGHT: PALETTE -->
            <aside class="col-span-12 lg:col-span-2">
                <div
                    class="bg-white border border-slate-200 rounded-2xl shadow-sm p-4 sticky top-28 max-h-[70vh] flex flex-col">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 px-2">Navigation</h3>
                    <div class="flex-1 overflow-y-auto custom-scrollbar pr-1">

                        <!-- PALETTE GROUPS -->
                        <div id="paletteContainer" class="space-y-6">
                            <!-- DEMO Groups -->
                            <section>
                                <h6 class="text-[10px] font-bold text-slate-400 mb-2 px-1">DEMO SET</h6>
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="jumpQ(this)" data-index="0"
                                        class="palette-btn w-10 h-10 rounded-full border border-slate-200 flex items-center justify-center font-bold text-xs hover:bg-blue-50 transition-all">1</button>
                                    <button onclick="jumpQ(this)" data-index="1"
                                        class="palette-btn w-10 h-10 rounded-full border border-slate-200 flex items-center justify-center font-bold text-xs hover:bg-blue-50 transition-all">2</button>
                                    <button onclick="jumpQ(this)" data-index="2"
                                        class="palette-btn w-10 h-10 rounded-full border border-slate-200 flex items-center justify-center font-bold text-xs hover:bg-blue-50 transition-all">3</button>
                                </div>
                            </section>

                            <!-- Dynamic Groups using Thymeleaf -->
                            <section th:if="${#lists.size(questions) > 0}">
                                <h6 class="text-[10px] font-bold text-slate-400 mb-2 px-1">MAIN EXAM</h6>
                                <div class="flex flex-wrap gap-2">
                                    <button th:each="q,stat : ${questions}" th:attr="data-index=${stat.index + 3}"
                                        onclick="jumpQ(this)"
                                        class="palette-btn w-10 h-10 rounded-full border border-slate-200 flex items-center justify-center font-bold text-xs hover:bg-blue-50 transition-all"
                                        th:text="${stat.count + 3}"></button>
                                </div>
                            </section>
                        </div>

                    </div>

                    <!-- LEGEND -->
                    <div class="mt-4 pt-4 border-t border-slate-100 text-[10px] text-slate-400 font-medium space-y-1">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 rounded-full bg-emerald-500"></div> Answered
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 rounded-full bg-blue-600"></div> Current
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 rounded-full bg-slate-200"></div> Not Visited
                        </div>
                    </div>
                </div>
            </aside>

        </div>
    </div>

    <script>
        let current = 0;
        const getSlides = () => document.querySelectorAll('.question-slide');
        const getPalette = () => document.querySelectorAll('.palette-btn');

        function showQ(i) {
            const slides = getSlides();
            const palette = getPalette();
            const nextBtn = document.getElementById('nextBtn');
            const prevBtn = document.getElementById('prevBtn');

            if (!slides[i]) return;

            // Toggle Slides
            slides.forEach(s => s.style.display = 'none');
            slides[i].style.display = 'block';

            // Highlight Palette
            palette.forEach(p => {
                p.classList.remove('bg-blue-600', 'text-white', 'border-blue-600', 'shadow-lg', 'shadow-blue-200');
                if (parseInt(p.dataset.index) === i) {
                    p.classList.add('bg-blue-600', 'text-white', 'border-blue-600', 'shadow-lg', 'shadow-blue-200');
                }
            });

            // Update Buttons
            prevBtn.disabled = (i === 0);
            nextBtn.disabled = (i === slides.length - 1);

            // Specific Next button styling for disability
            if (nextBtn.disabled) {
                nextBtn.classList.add('opacity-30');
            } else {
                nextBtn.classList.remove('opacity-30');
            }

            current = i;
        }

        function nextQ() {
            const slides = getSlides();
            if (current < slides.length - 1) showQ(current + 1);
        }

        function prevQ() {
            if (current > 0) showQ(current - 1);
        }

        function jumpQ(btn) {
            showQ(parseInt(btn.dataset.index));
        }

        function jumpSection(type) {
            const slides = getSlides();
            const idx = Array.from(slides).findIndex(s => s.dataset.type === type);
            if (idx >= 0) showQ(idx);
        }

        function markAnswered() {
            const palette = getPalette();
            palette.forEach(p => {
                if (parseInt(p.dataset.index) === current) {
                    p.classList.add('bg-emerald-500', 'text-white', 'border-emerald-500');
                }
            });
        }

        function fillSelect(btn) {
            const btns = btn.parentElement.querySelectorAll('.fill-btn');
            btns.forEach(b => b.classList.remove('bg-blue-600', 'text-white', 'border-blue-600'));
            btn.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
            markAnswered();
        }

        function submitExam() {
            if (confirm("Are you sure you want to finish the exam? This action cannot be undone.")) {
                alert("Exam submitted! Redirecting to dashboard...");
                // window.location.href = "/student/dashboard";
            }
        }

        window.onload = () => showQ(0);
    </script>
</body>

</html>